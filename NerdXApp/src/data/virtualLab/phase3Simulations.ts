// Phase 3: Expanded Virtual Lab simulations (hands-on + DeepSeek-generated knowledge checks)

import { SimulationMetadata, QuizQuestion, HandsOnActivityConfig } from './simulationTypes';

// ----------------------------
// Hands-on activity helpers
// ----------------------------

const exp = (cfg: HandsOnActivityConfig): HandsOnActivityConfig => cfg;

const bioExp = (idPrefix: string, intro: string, taskTheme: 'rate' | 'balance' | 'control' = 'rate') =>
  exp({
    type: 'experiment_runner',
    intro,
    controls: [
      { id: 'a', label: 'Factor A', min: 0, max: 10, step: 1, defaultValue: 5 },
      { id: 'b', label: 'Factor B', min: 0, max: 10, step: 1, defaultValue: 5 },
      { id: 'c', label: 'Factor C', min: 0, max: 10, step: 1, defaultValue: 5 },
    ],
    readouts: [
      { id: 'rate', label: 'Process rate', unit: 'units', formula: '(a*b)/10 + c/2', decimals: 1 },
      { id: 'eff', label: 'Efficiency', unit: '%', formula: '10*rate', decimals: 0 },
    ],
    tasks: [
      { id: `${idPrefix}-t1`, instruction: 'Make the rate high (≥ 8)', condition: 'rate >= 8' },
      { id: `${idPrefix}-t2`, instruction: 'Make the rate low (≤ 4)', condition: 'rate <= 4' },
      { id: `${idPrefix}-t3`, instruction: taskTheme === 'control' ? 'Keep rate between 5 and 7' : 'Set Factor C to 8 or more', condition: taskTheme === 'control' ? 'rate >= 5 && rate <= 7' : 'c >= 8' },
    ],
    requiredTasksToUnlock: 2,
  });

const chemExp = (idPrefix: string, intro: string) =>
  exp({
    type: 'experiment_runner',
    intro,
    controls: [
      { id: 'acid', label: 'Acid amount', unit: 'mL', min: 0, max: 50, step: 5, defaultValue: 25 },
      { id: 'base', label: 'Base amount', unit: 'mL', min: 0, max: 50, step: 5, defaultValue: 25 },
      { id: 'conc', label: 'Concentration', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 2 },
    ],
    readouts: [
      { id: 'excess', label: 'Excess (acid - base)', unit: 'mL', formula: 'acid - base', decimals: 0 },
      { id: 'ph', label: 'Estimated pH', formula: '7 + (base - acid)/(10*conc)', decimals: 2 },
    ],
    tasks: [
      { id: `${idPrefix}-t1`, instruction: 'Make the mixture neutral (pH 6.8–7.2)', condition: 'ph >= 6.8 && ph <= 7.2' },
      { id: `${idPrefix}-t2`, instruction: 'Make the mixture acidic (pH ≤ 6.5)', condition: 'ph <= 6.5' },
      { id: `${idPrefix}-t3`, instruction: 'Make the mixture alkaline (pH ≥ 7.5)', condition: 'ph >= 7.5' },
    ],
    requiredTasksToUnlock: 2,
  });

const physExp = (idPrefix: string, intro: string) =>
  exp({
    type: 'experiment_runner',
    intro,
    controls: [
      { id: 'x', label: 'Value X', min: 1, max: 20, step: 1, defaultValue: 10 },
      { id: 'y', label: 'Value Y', min: 1, max: 20, step: 1, defaultValue: 5 },
      { id: 't', label: 'Time', unit: 's', min: 1, max: 20, step: 1, defaultValue: 5 },
    ],
    readouts: [
      { id: 'result', label: 'Result', formula: '(x*y)/t', decimals: 2 },
      { id: 'check', label: 'Check', formula: 'result', decimals: 2 },
    ],
    tasks: [
      { id: `${idPrefix}-t1`, instruction: 'Make result ≥ 10', condition: 'result >= 10' },
      { id: `${idPrefix}-t2`, instruction: 'Make result ≤ 5', condition: 'result <= 5' },
      { id: `${idPrefix}-t3`, instruction: 'Keep time between 4 and 8 seconds', condition: 't >= 4 && t <= 8' },
    ],
    requiredTasksToUnlock: 2,
  });

const match = (prompt: string, pairs: { left: string; right: string }[], requiredCorrectToUnlock = 3): HandsOnActivityConfig =>
  exp({ type: 'matching', prompt, pairs, requiredCorrectToUnlock });

const seq = (prompt: string, steps: string[]): HandsOnActivityConfig =>
  exp({ type: 'sequencing', prompt, steps, requiredCorrectToUnlock: steps.length });

const makeFallbackQuestions = (prefix: string, topic: string): QuizQuestion[] => [
  {
    id: `${prefix}-q1`,
    question: `Which statement best describes the main idea of "${topic}"?`,
    options: ['A definition only', 'A single memorized fact', 'A practical application only', 'A concept you can define, explain, and apply'],
    correctIndex: 3,
    explanation: 'Good understanding includes definition, explanation, and application.',
  },
  {
    id: `${prefix}-q2`,
    question: `In exam questions on "${topic}", what is usually most important?`,
    options: ['Using correct terms', 'Showing clear reasoning', 'Linking to real examples', 'All of the above'],
    correctIndex: 3,
    explanation: 'Clear terminology, reasoning, and examples are all rewarded at O-Level.',
  },
  {
    id: `${prefix}-q3`,
    question: `Which approach is best when you are unsure about a question on "${topic}"?`,
    options: ['Guess immediately', 'Skip all working', 'Identify key words and eliminate wrong options', 'Avoid reading the question'],
    correctIndex: 2,
    explanation: 'Key words and elimination improve accuracy even when you are unsure.',
  },
  {
    id: `${prefix}-q4`,
    question: `What should you do after getting a question wrong on "${topic}"?`,
    options: ['Ignore it', 'Memorize the answer only', 'Review the explanation and the key concept', 'Stop practicing'],
    correctIndex: 2,
    explanation: 'Reviewing the explanation builds the underlying concept and prevents repeat mistakes.',
  },
];

export const PHASE3_SIMULATIONS: SimulationMetadata[] = [
  // ==========================
  // BIOLOGY (18)
  // ==========================
  {
    id: 'bio-respiration-aerobic',
    title: 'Aerobic Respiration Lab',
    subject: 'biology',
    topic: 'Respiration',
    description: 'Explore aerobic respiration, energy release, and how oxygen affects cellular energy production.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bra-1', text: 'State the word equation for aerobic respiration' },
      { id: 'bra-2', text: 'Explain why oxygen is needed in aerobic respiration' },
      { id: 'bra-3', text: 'Link respiration to energy for movement, growth, and repair' },
    ],
    handsOnActivity: bioExp('bra', 'Adjust oxygen availability, fuel supply, and temperature to see how aerobic energy production changes.', 'rate'),
    quizQuestions: makeFallbackQuestions('bra', 'Respiration'),
  },
  {
    id: 'bio-respiration-anaerobic',
    title: 'Anaerobic Respiration Lab',
    subject: 'biology',
    topic: 'Respiration',
    description: 'Compare anaerobic respiration in muscles and yeast, including lactic acid and ethanol production.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'brn-1', text: 'Distinguish aerobic vs anaerobic respiration' },
      { id: 'brn-2', text: 'State products of anaerobic respiration in yeast and muscles' },
      { id: 'brn-3', text: 'Explain oxygen debt and lactic acid buildup' },
    ],
    handsOnActivity: bioExp('brn', 'Reduce oxygen and see how “energy yield” and “efficiency” changes in anaerobic conditions.', 'rate'),
    quizQuestions: makeFallbackQuestions('brn', 'Respiration'),
  },
  {
    id: 'bio-gas-exchange',
    title: 'Gas Exchange Explorer',
    subject: 'biology',
    topic: 'Transport in Humans',
    description: 'Learn how oxygen and carbon dioxide move between alveoli and blood by diffusion.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'microscope',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bge-1', text: 'Explain diffusion in gas exchange' },
      { id: 'bge-2', text: 'Describe adaptations of alveoli for efficient exchange' },
      { id: 'bge-3', text: 'Relate breathing rate to exercise demand' },
    ],
    handsOnActivity: bioExp('bge', 'Change surface area, ventilation and gradient to model diffusion rate in the lungs.', 'rate'),
    quizQuestions: makeFallbackQuestions('bge', 'Gas exchange'),
  },
  {
    id: 'bio-digestive-journey',
    title: 'Digestive Journey',
    subject: 'biology',
    topic: 'Nutrition (Digestion)',
    description: 'Trace the path of food, key enzymes, and absorption in the small intestine.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bdj-1', text: 'Identify major organs of the alimentary canal' },
      { id: 'bdj-2', text: 'State roles of enzymes in digestion' },
      { id: 'bdj-3', text: 'Explain absorption in villi' },
    ],
    handsOnActivity: seq('Arrange the digestion process in the correct order:', [
      'Ingestion',
      'Digestion',
      'Absorption',
      'Assimilation',
      'Egestion',
    ]),
    quizQuestions: makeFallbackQuestions('bdj', 'Digestion'),
  },
  {
    id: 'bio-ecology-food-webs',
    title: 'Ecology Food Web Builder',
    subject: 'biology',
    topic: 'Ecology',
    description: 'Build food chains and food webs, and explore energy flow and pyramids of numbers.',
    difficulty: 'easy',
    xpReward: 150,
    estimatedTime: '10-15 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bef-1', text: 'Define producer, consumer, and decomposer' },
      { id: 'bef-2', text: 'Construct a food chain and a food web' },
      { id: 'bef-3', text: 'Explain energy loss between trophic levels' },
    ],
    handsOnActivity: match('Match each ecology term to its meaning:', [
      { left: 'Producer', right: 'Makes its own food (photosynthesis)' },
      { left: 'Primary consumer', right: 'Eats producers' },
      { left: 'Decomposer', right: 'Breaks down dead matter' },
      { left: 'Trophic level', right: 'Feeding position in a chain' },
    ]),
    quizQuestions: makeFallbackQuestions('bef', 'Ecology'),
  },
  {
    id: 'bio-population-growth',
    title: 'Population Growth Simulator',
    subject: 'biology',
    topic: 'Ecology',
    description: 'Explore how birth rate, death rate, and resources affect population growth over time.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bpg-1', text: 'Define population and carrying capacity (intro level)' },
      { id: 'bpg-2', text: 'Explain how limiting factors affect population size' },
      { id: 'bpg-3', text: 'Predict conditions for population increase or decrease' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust birth rate, death rate, and resources and observe a simple growth model.',
      controls: [
        { id: 'birth', label: 'Birth rate', unit: 'x', min: 0, max: 10, step: 1, defaultValue: 6 },
        { id: 'death', label: 'Death rate', unit: 'x', min: 0, max: 10, step: 1, defaultValue: 4 },
        { id: 'res', label: 'Resources', unit: 'x', min: 0, max: 10, step: 1, defaultValue: 5 },
      ],
      readouts: [
        { id: 'growth', label: 'Growth index', unit: 'units', formula: '(birth - death) + res/2', decimals: 1 },
      ],
      tasks: [
        { id: 'bpg-t1', instruction: 'Make growth positive (≥ 2)', condition: 'growth >= 2' },
        { id: 'bpg-t2', instruction: 'Make growth negative (≤ -1)', condition: 'growth <= -1' },
        { id: 'bpg-t3', instruction: 'Increase resources to 8 or more', condition: 'res >= 8' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('bpg', 'Ecology'),
  },
  {
    id: 'bio-photosynthesis-limiting-factors',
    title: 'Limiting Factors Simulator',
    subject: 'biology',
    topic: 'Photosynthesis',
    description: 'Investigate limiting factors such as light, carbon dioxide, and temperature on photosynthesis rate.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'blf-1', text: 'Define limiting factor' },
      { id: 'blf-2', text: 'Predict graphs for rate vs limiting factors' },
      { id: 'blf-3', text: 'Explain why plateaus occur in rate graphs' },
    ],
    handsOnActivity: bioExp('blf', 'Adjust light, CO₂ and temperature to model changes in photosynthesis rate.', 'rate'),
    quizQuestions: makeFallbackQuestions('blf', 'Photosynthesis'),
  },
  {
    id: 'bio-transport-plants-xylem',
    title: 'Xylem Transport Lab',
    subject: 'biology',
    topic: 'Transport in Plants',
    description: 'Explore water transport in xylem and the role of transpiration pull.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'water',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bxt-1', text: 'Describe the structure of xylem vessels' },
      { id: 'bxt-2', text: 'Explain transpiration pull and cohesion-tension' },
      { id: 'bxt-3', text: 'Identify factors affecting transpiration' },
    ],
    handsOnActivity: bioExp('bxt', 'Change environment factors to see how transpiration rate changes.', 'rate'),
    quizQuestions: makeFallbackQuestions('bxt', 'Transport in Plants'),
  },
  {
    id: 'bio-transport-plants-phloem',
    title: 'Phloem Translocation Lab',
    subject: 'biology',
    topic: 'Transport in Plants',
    description: 'Learn how sugars move in phloem from sources to sinks (translocation).',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'water',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bpt-1', text: 'Define translocation' },
      { id: 'bpt-2', text: 'Explain source and sink concepts' },
      { id: 'bpt-3', text: 'Compare xylem and phloem transport' },
    ],
    handsOnActivity: match('Match the term to the correct description:', [
      { left: 'Translocation', right: 'Movement of sugars in phloem' },
      { left: 'Source', right: 'Where sugars are produced (e.g., leaf)' },
      { left: 'Sink', right: 'Where sugars are used/stored (e.g., root/fruit)' },
      { left: 'Phloem', right: 'Living tissue that transports sucrose' },
    ]),
    quizQuestions: makeFallbackQuestions('bpt', 'Transport in Plants'),
  },
  {
    id: 'bio-homeostasis-thermoregulation',
    title: 'Thermoregulation Lab',
    subject: 'biology',
    topic: 'Homeostasis',
    description: 'Explore how the human body regulates temperature via sweating, shivering, and blood flow changes.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'microscope',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bth-1', text: 'Define homeostasis' },
      { id: 'bth-2', text: 'Explain negative feedback in temperature control' },
      { id: 'bth-3', text: 'Describe vasodilation and vasoconstriction' },
    ],
    handsOnActivity: bioExp('bth', 'Model thermoregulation by adjusting heat loss/gain factors and aiming for stable conditions.', 'control'),
    quizQuestions: makeFallbackQuestions('bth', 'Homeostasis'),
  },
  {
    id: 'bio-homeostasis-glucose',
    title: 'Blood Glucose Control',
    subject: 'biology',
    topic: 'Homeostasis',
    description: 'Model how insulin and glucagon regulate blood glucose with negative feedback.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'microscope',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bbg-1', text: 'State roles of insulin and glucagon' },
      { id: 'bbg-2', text: 'Describe negative feedback control' },
      { id: 'bbg-3', text: 'Explain diabetes as loss of glucose regulation' },
    ],
    handsOnActivity: bioExp('bbg', 'Adjust intake, activity, and hormone response to keep glucose stable.', 'control'),
    quizQuestions: makeFallbackQuestions('bbg', 'Homeostasis'),
  },
  {
    id: 'bio-excretion-kidney',
    title: 'Kidney Filtration Simulator',
    subject: 'biology',
    topic: 'Excretion',
    description: 'Explore filtration, reabsorption, and urine formation in the nephron.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'water',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bkf-1', text: 'Describe ultrafiltration in the glomerulus' },
      { id: 'bkf-2', text: 'Explain selective reabsorption' },
      { id: 'bkf-3', text: 'Relate ADH to water balance' },
    ],
    handsOnActivity: bioExp('bkf', 'Explore urine output and water balance by changing intake and control factors.', 'control'),
    quizQuestions: makeFallbackQuestions('bkf', 'Excretion'),
  },
  {
    id: 'bio-reproduction-flowering-plants',
    title: 'Flower Pollination Lab',
    subject: 'biology',
    topic: 'Reproduction',
    description: 'Explore flower structure, pollination, fertilisation, and seed formation.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bfp-1', text: 'Identify parts of a flower' },
      { id: 'bfp-2', text: 'Explain pollination and fertilisation' },
      { id: 'bfp-3', text: 'Describe seed and fruit formation' },
    ],
    handsOnActivity: seq('Arrange the plant reproduction steps in order:', [
      'Pollination',
      'Pollen tube growth',
      'Fertilisation',
      'Seed formation',
      'Fruit formation',
    ]),
    quizQuestions: makeFallbackQuestions('bfp', 'Reproduction'),
  },
  {
    id: 'bio-reproduction-human',
    title: 'Human Reproduction Basics',
    subject: 'biology',
    topic: 'Reproduction',
    description: 'Review reproductive organs, menstrual cycle basics, and the role of hormones.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'microscope',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bhr-1', text: 'Identify male and female reproductive organs' },
      { id: 'bhr-2', text: 'Outline the menstrual cycle' },
      { id: 'bhr-3', text: 'State basic roles of reproductive hormones' },
    ],
    handsOnActivity: match('Match each item to its role:', [
      { left: 'Ovary', right: 'Produces ova (eggs)' },
      { left: 'Testis', right: 'Produces sperm' },
      { left: 'Uterus', right: 'Where foetus develops' },
      { left: 'Hormone', right: 'Chemical messenger controlling processes' },
    ]),
    quizQuestions: makeFallbackQuestions('bhr', 'Reproduction'),
  },
  {
    id: 'bio-genetics-inheritance',
    title: 'Genetics Inheritance Lab',
    subject: 'biology',
    topic: 'Inheritance',
    description: 'Practice simple inheritance patterns with allele notation and Punnett squares.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'microscope',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bgi-1', text: 'Define genotype and phenotype' },
      { id: 'bgi-2', text: 'Use Punnett squares for monohybrid crosses' },
      { id: 'bgi-3', text: 'Predict offspring ratios for dominant/recessive traits' },
    ],
    handsOnActivity: match('Match genetics terms to meanings:', [
      { left: 'Genotype', right: 'Genetic makeup (alleles) of an organism' },
      { left: 'Phenotype', right: 'Observable characteristic' },
      { left: 'Dominant', right: 'Expressed when one allele is present' },
      { left: 'Recessive', right: 'Expressed only when two alleles are present' },
    ]),
    quizQuestions: makeFallbackQuestions('bgi', 'Inheritance'),
  },
  {
    id: 'bio-variation-adaptation',
    title: 'Variation & Adaptation',
    subject: 'biology',
    topic: 'Ecology',
    description: 'Explore how variation and adaptation improve survival in different environments.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bva-1', text: 'Define variation and adaptation' },
      { id: 'bva-2', text: 'Give examples of advantageous adaptations' },
      { id: 'bva-3', text: 'Relate selection pressure to survival' },
    ],
    handsOnActivity: match('Match an adaptation to its benefit:', [
      { left: 'Camouflage', right: 'Avoids predators by blending in' },
      { left: 'Thick fur', right: 'Reduces heat loss in cold climates' },
      { left: 'Long roots', right: 'Reaches water deep in soil' },
      { left: 'Sharp beak', right: 'Helps obtain specific food' },
    ]),
    quizQuestions: makeFallbackQuestions('bva', 'Adaptation'),
  },
  {
    id: 'bio-microbes-disease',
    title: 'Microbes & Disease',
    subject: 'biology',
    topic: 'Health and Disease',
    description: 'Study pathogens, transmission, prevention, and basic immune responses.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'microscope',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bmd-1', text: 'Define pathogen and disease transmission' },
      { id: 'bmd-2', text: 'Explain vaccination in simple terms' },
      { id: 'bmd-3', text: 'Describe basic hygiene-based prevention' },
    ],
    handsOnActivity: match('Match the prevention method to what it helps reduce:', [
      { left: 'Hand washing', right: 'Reduces pathogen transfer by contact' },
      { left: 'Boiling water', right: 'Kills many microorganisms' },
      { left: 'Vaccination', right: 'Builds immune memory' },
      { left: 'Mosquito nets', right: 'Reduces insect-borne transmission' },
    ]),
    quizQuestions: makeFallbackQuestions('bmd', 'Health and Disease'),
  },
  {
    id: 'bio-ecosystems-conservation',
    title: 'Conservation Challenge',
    subject: 'biology',
    topic: 'Ecology',
    description: 'Explore conservation methods, pollution effects, and sustainable resource use.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'leaf',
    color: '#4CAF50',
    learningObjectives: [
      { id: 'bec-1', text: 'Explain how pollution affects ecosystems' },
      { id: 'bec-2', text: 'Describe conservation strategies (protected areas, laws)' },
      { id: 'bec-3', text: 'Relate conservation to biodiversity' },
    ],
    handsOnActivity: bioExp('bec', 'Adjust “pressure” factors and see how biodiversity/efficiency changes in a simple ecosystem model.', 'balance'),
    quizQuestions: makeFallbackQuestions('bec', 'Conservation'),
  },

  // ==========================
  // CHEMISTRY (16)
  // ==========================
  {
    id: 'chem-bonding-basics',
    title: 'Bonding Basics',
    subject: 'chemistry',
    topic: 'Chemical Bonding',
    description: 'Compare ionic, covalent, and metallic bonding and link bonding to properties.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'atom',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cbb-1', text: 'Distinguish ionic and covalent bonding' },
      { id: 'cbb-2', text: 'Explain why ionic compounds conduct when molten' },
      { id: 'cbb-3', text: 'Link bonding to melting point and conductivity' },
    ],
    handsOnActivity: match('Match bonding type to a typical property:', [
      { left: 'Ionic', right: 'Conducts when molten/aqueous' },
      { left: 'Covalent (simple)', right: 'Low melting point' },
      { left: 'Metallic', right: 'Good electrical conductor (solid)' },
      { left: 'Giant covalent', right: 'Very high melting point' },
    ]),
    quizQuestions: makeFallbackQuestions('cbb', 'Chemical Bonding'),
  },
  {
    id: 'chem-metals-reactivity',
    title: 'Reactivity Series Lab',
    subject: 'chemistry',
    topic: 'Metals',
    description: 'Explore the reactivity series and displacement reactions of metals.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'beaker',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cmr-1', text: 'State what the reactivity series shows' },
      { id: 'cmr-2', text: 'Predict displacement reactions' },
      { id: 'cmr-3', text: 'Relate reactivity to extraction methods' },
    ],
    handsOnActivity: match('Match the metal to the typical reactivity description:', [
      { left: 'Potassium', right: 'Very reactive' },
      { left: 'Magnesium', right: 'Reacts with dilute acids' },
      { left: 'Copper', right: 'Low reactivity (often unreactive with dilute acids)' },
      { left: 'Zinc', right: 'Moderately reactive; displaces copper' },
    ]),
    quizQuestions: makeFallbackQuestions('cmr', 'Metals'),
  },
  {
    id: 'chem-acids-bases-neutralisation',
    title: 'Neutralisation Lab',
    subject: 'chemistry',
    topic: 'Acids, Bases and Salts',
    description: 'Model neutralisation and learn to write word/symbol equations for acid-base reactions.',
    difficulty: 'easy',
    xpReward: 150,
    estimatedTime: '10-15 mins',
    icon: 'beaker',
    color: '#FF9800',
    learningObjectives: [
      { id: 'can-1', text: 'Define acid and base (simple properties)' },
      { id: 'can-2', text: 'Describe neutralisation' },
      { id: 'can-3', text: 'Predict products of acid + base reactions' },
    ],
    handsOnActivity: chemExp('can', 'Mix acid and base and observe how the estimated pH changes.'),
    quizQuestions: makeFallbackQuestions('can', 'Acids, Bases and Salts'),
  },
  {
    id: 'chem-salts-preparation',
    title: 'Salt Preparation Workshop',
    subject: 'chemistry',
    topic: 'Acids, Bases and Salts',
    description: 'Learn common methods of preparing salts (acid + metal, acid + base, precipitation).',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'beaker',
    color: '#FF9800',
    learningObjectives: [
      { id: 'csp-1', text: 'Choose correct method to prepare a soluble salt' },
      { id: 'csp-2', text: 'Explain precipitation for insoluble salts' },
      { id: 'csp-3', text: 'Describe filtration and crystallisation steps' },
    ],
    handsOnActivity: seq('Arrange the soluble salt preparation steps:', [
      'Add excess insoluble base to acid',
      'Filter to remove excess solid',
      'Heat to concentrate solution',
      'Cool to crystallise',
      'Dry crystals',
    ]),
    quizQuestions: makeFallbackQuestions('csp', 'Salts'),
  },
  {
    id: 'chem-rates-reaction',
    title: 'Rates of Reaction Lab',
    subject: 'chemistry',
    topic: 'Rates of Reaction',
    description: 'Explore how concentration, temperature, surface area, and catalysts affect reaction rate.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'flask',
    color: '#FF9800',
    learningObjectives: [
      { id: 'crr-1', text: 'Identify factors affecting rate' },
      { id: 'crr-2', text: 'Interpret simple rate graphs' },
      { id: 'crr-3', text: 'Explain catalysts in terms of activation energy' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust temperature, concentration, and surface area and observe a simple rate model.',
      controls: [
        { id: 'temp', label: 'Temperature', unit: '°C', min: 10, max: 80, step: 5, defaultValue: 30 },
        { id: 'conc', label: 'Concentration', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 2 },
        { id: 'area', label: 'Surface area', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 2 },
      ],
      readouts: [
        { id: 'rate', label: 'Rate', unit: 'units', formula: '(temp/20) + conc + area', decimals: 1 },
      ],
      tasks: [
        { id: 'crr-t1', instruction: 'Make the rate high (≥ 9)', condition: 'rate >= 9' },
        { id: 'crr-t2', instruction: 'Make the rate low (≤ 6)', condition: 'rate <= 6' },
        { id: 'crr-t3', instruction: 'Increase temperature to 60°C or more', condition: 'temp >= 60' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('crr', 'Rates of Reaction'),
  },
  {
    id: 'chem-energy-changes',
    title: 'Energy Changes Explorer',
    subject: 'chemistry',
    topic: 'Energetics',
    description: 'Distinguish endothermic and exothermic reactions and interpret energy profile diagrams.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'flash',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cee-1', text: 'Define exothermic and endothermic' },
      { id: 'cee-2', text: 'Relate energy changes to temperature change' },
      { id: 'cee-3', text: 'Interpret basic energy profiles' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust “energy released/absorbed” and “mass of water” to see temperature change.',
      controls: [
        { id: 'q', label: 'Heat change (Q)', unit: 'kJ', min: -50, max: 50, step: 5, defaultValue: 10 },
        { id: 'm', label: 'Water mass', unit: 'kg', min: 1, max: 10, step: 1, defaultValue: 2 },
        { id: 'c', label: 'Specific heat factor', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 4 },
      ],
      readouts: [
        { id: 'dT', label: 'Temperature change', unit: '°C', formula: 'q/(m*c)', decimals: 2 },
      ],
      tasks: [
        { id: 'cee-t1', instruction: 'Make dT positive (exothermic effect)', condition: 'dT > 0' },
        { id: 'cee-t2', instruction: 'Make dT negative (endothermic effect)', condition: 'dT < 0' },
        { id: 'cee-t3', instruction: 'Make |dT| small (between -1 and 1)', condition: 'dT >= -1 && dT <= 1' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('cee', 'Energetics'),
  },
  {
    id: 'chem-electrochem-cells',
    title: 'Electrochemical Cells',
    subject: 'chemistry',
    topic: 'Electricity and Chemistry',
    description: 'Explore how chemical reactions produce electricity in simple cells.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'flash',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cec-1', text: 'Describe oxidation and reduction in simple terms' },
      { id: 'cec-2', text: 'Identify anode and cathode in a cell' },
      { id: 'cec-3', text: 'Relate reactivity to voltage produced' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Choose two different metals and an electrolyte strength and observe a simple voltage model.',
      controls: [
        { id: 'm1', label: 'Metal A reactivity', unit: 'x', min: 1, max: 10, step: 1, defaultValue: 8 },
        { id: 'm2', label: 'Metal B reactivity', unit: 'x', min: 1, max: 10, step: 1, defaultValue: 3 },
        { id: 'e', label: 'Electrolyte strength', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 2 },
      ],
      readouts: [
        { id: 'V', label: 'Cell voltage', unit: 'V', formula: '(m1 - m2)/5 + e/2', decimals: 2 },
      ],
      tasks: [
        { id: 'cec-t1', instruction: 'Make voltage high (≥ 2.0 V)', condition: 'V >= 2' },
        { id: 'cec-t2', instruction: 'Make voltage low (≤ 1.0 V)', condition: 'V <= 1' },
        { id: 'cec-t3', instruction: 'Increase electrolyte strength to 4 or 5', condition: 'e >= 4' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('cec', 'Electricity and Chemistry'),
  },
  {
    id: 'chem-organic-alkanes-alkenes',
    title: 'Hydrocarbons Lab',
    subject: 'chemistry',
    topic: 'Organic Chemistry',
    description: 'Compare alkanes and alkenes, their general formulae, and basic reactions.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'atom',
    color: '#FF9800',
    learningObjectives: [
      { id: 'coh-1', text: 'State general formula for alkanes and alkenes' },
      { id: 'coh-2', text: 'Explain saturated vs unsaturated' },
      { id: 'coh-3', text: 'Describe bromine water test for alkenes' },
    ],
    handsOnActivity: match('Match the hydrocarbon type to a key feature:', [
      { left: 'Alkane', right: 'Saturated; single bonds only' },
      { left: 'Alkene', right: 'Unsaturated; contains C=C' },
      { left: 'Bromine water test', right: 'Decolourises with alkenes' },
      { left: 'General formula (alkane)', right: 'CₙH₂ₙ₊₂' },
    ]),
    quizQuestions: makeFallbackQuestions('coh', 'Organic Chemistry'),
  },
  {
    id: 'chem-organic-alcohols-acids',
    title: 'Alcohols & Acids',
    subject: 'chemistry',
    topic: 'Organic Chemistry',
    description: 'Explore simple properties and reactions of alcohols and carboxylic acids.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'flask',
    color: '#FF9800',
    learningObjectives: [
      { id: 'coa-1', text: 'Identify alcohol and carboxylic acid functional groups' },
      { id: 'coa-2', text: 'Describe simple reactions (combustion, neutralisation)' },
      { id: 'coa-3', text: 'Relate structure to properties (solubility, acidity)' },
    ],
    handsOnActivity: match('Match the group to the compound type:', [
      { left: '-OH', right: 'Alcohol functional group' },
      { left: '-COOH', right: 'Carboxylic acid functional group' },
      { left: 'Ethanoic acid', right: 'Weak acid found in vinegar' },
      { left: 'Ethanol', right: 'Alcohol; can burn as a fuel' },
    ]),
    quizQuestions: makeFallbackQuestions('coa', 'Organic Chemistry'),
  },
  {
    id: 'chem-air-water',
    title: 'Air & Water Chemistry',
    subject: 'chemistry',
    topic: 'Air and Water',
    description: 'Study composition of air, water purification, and common pollutants.',
    difficulty: 'easy',
    xpReward: 150,
    estimatedTime: '10-15 mins',
    icon: 'water',
    color: '#FF9800',
    learningObjectives: [
      { id: 'caw-1', text: 'State main gases in air' },
      { id: 'caw-2', text: 'Describe basic water purification steps' },
      { id: 'caw-3', text: 'Identify examples of air and water pollution' },
    ],
    handsOnActivity: seq('Arrange the basic water purification steps:', [
      'Coagulation/settling',
      'Filtration',
      'Chlorination (disinfection)',
      'Safe storage',
    ]),
    quizQuestions: makeFallbackQuestions('caw', 'Air and Water'),
  },
  {
    id: 'chem-atomic-structure-isotopes',
    title: 'Isotopes Explorer',
    subject: 'chemistry',
    topic: 'Atomic Structure',
    description: 'Explore isotopes and relate atomic number and mass number to particle counts.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'atom',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cai-1', text: 'Define isotope' },
      { id: 'cai-2', text: 'Calculate neutrons from mass and atomic number' },
      { id: 'cai-3', text: 'Explain why isotopes have similar chemical properties' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust protons and neutrons to model atomic number and mass number.',
      controls: [
        { id: 'p', label: 'Protons', min: 1, max: 20, step: 1, defaultValue: 6 },
        { id: 'n', label: 'Neutrons', min: 0, max: 25, step: 1, defaultValue: 6 },
        { id: 'e', label: 'Electrons', min: 1, max: 20, step: 1, defaultValue: 6 },
      ],
      readouts: [
        { id: 'Z', label: 'Atomic number (Z)', formula: 'p', decimals: 0 },
        { id: 'A', label: 'Mass number (A)', formula: 'p + n', decimals: 0 },
      ],
      tasks: [
        { id: 'cai-t1', instruction: 'Make an isotope (change neutrons)', condition: 'n != 6' },
        { id: 'cai-t2', instruction: 'Set mass number to 12 or more', condition: 'A >= 12' },
        { id: 'cai-t3', instruction: 'Keep atomic number at 6', condition: 'Z == 6' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('cai', 'Atomic Structure'),
  },
  {
    id: 'chem-separation-mixtures',
    title: 'Mixtures & Separation',
    subject: 'chemistry',
    topic: 'Separation Techniques',
    description: 'Choose the right separation method (filtration, distillation, chromatography) for mixtures.',
    difficulty: 'easy',
    xpReward: 150,
    estimatedTime: '10-15 mins',
    icon: 'beaker',
    color: '#FF9800',
    learningObjectives: [
      { id: 'csm-1', text: 'Select filtration for insoluble solids' },
      { id: 'csm-2', text: 'Distinguish simple vs fractional distillation' },
      { id: 'csm-3', text: 'Explain chromatography for pigments' },
    ],
    handsOnActivity: match('Match the mixture to the best separation method:', [
      { left: 'Sand + water', right: 'Filtration' },
      { left: 'Ethanol + water', right: 'Fractional distillation' },
      { left: 'Salt + water', right: 'Evaporation/crystallisation' },
      { left: 'Ink pigments', right: 'Chromatography' },
    ]),
    quizQuestions: makeFallbackQuestions('csm', 'Separation Techniques'),
  },
  {
    id: 'chem-redox-basics',
    title: 'Redox Basics',
    subject: 'chemistry',
    topic: 'Redox and Electrochemistry',
    description: 'Explore oxidation and reduction, and identify oxidising/reducing agents (intro level).',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'flash',
    color: '#FF9800',
    learningObjectives: [
      { id: 'crx-1', text: 'Define oxidation and reduction (OIL RIG / electron transfer)' },
      { id: 'crx-2', text: 'Identify oxidising and reducing agents' },
      { id: 'crx-3', text: 'Apply redox ideas to simple reactions' },
    ],
    handsOnActivity: match('Match the idea to the correct statement:', [
      { left: 'Oxidation', right: 'Loss of electrons' },
      { left: 'Reduction', right: 'Gain of electrons' },
      { left: 'Oxidising agent', right: 'Causes oxidation; gets reduced' },
      { left: 'Reducing agent', right: 'Causes reduction; gets oxidised' },
    ]),
    quizQuestions: makeFallbackQuestions('crx', 'Redox'),
  },
  {
    id: 'chem-stoichiometry-moles',
    title: 'Mole Calculations',
    subject: 'chemistry',
    topic: 'Stoichiometry',
    description: 'Practice moles, molar mass, and reacting mass calculations (conceptual).',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'scale',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cmo-1', text: 'Define mole and molar mass' },
      { id: 'cmo-2', text: 'Convert mass to moles and vice versa' },
      { id: 'cmo-3', text: 'Use ratios from balanced equations' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Change mass and molar mass to see how the amount (moles) changes.',
      controls: [
        { id: 'm', label: 'Mass', unit: 'g', min: 1, max: 200, step: 1, defaultValue: 18 },
        { id: 'mm', label: 'Molar mass', unit: 'g/mol', min: 1, max: 100, step: 1, defaultValue: 18 },
        { id: 'k', label: 'Ratio factor', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 1 },
      ],
      readouts: [
        { id: 'n', label: 'Moles', unit: 'mol', formula: '(m/mm)*k', decimals: 3 },
      ],
      tasks: [
        { id: 'cmo-t1', instruction: 'Make moles ≥ 2.000', condition: 'n >= 2' },
        { id: 'cmo-t2', instruction: 'Make moles ≤ 0.500', condition: 'n <= 0.5' },
        { id: 'cmo-t3', instruction: 'Set molar mass to 50 g/mol or more', condition: 'mm >= 50' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('cmo', 'Stoichiometry'),
  },
  {
    id: 'chem-periodic-trends',
    title: 'Periodic Trends',
    subject: 'chemistry',
    topic: 'Periodic Table',
    description: 'Explore group properties, trends in reactivity, and basic periodic patterns.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'atom',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cpt-1', text: 'Locate groups and periods' },
      { id: 'cpt-2', text: 'Describe trends in Group 1 and Group 7' },
      { id: 'cpt-3', text: 'Relate electron shells to periodic position' },
    ],
    handsOnActivity: match('Match the group to a typical trend:', [
      { left: 'Group 1', right: 'Reactivity increases down the group' },
      { left: 'Group 7', right: 'Reactivity decreases down the group' },
      { left: 'Noble gases', right: 'Very unreactive' },
      { left: 'Period', right: 'Number of electron shells' },
    ]),
    quizQuestions: makeFallbackQuestions('cpt', 'Periodic Table'),
  },
  {
    id: 'chem-polymers-materials',
    title: 'Polymers & Materials',
    subject: 'chemistry',
    topic: 'Organic Chemistry',
    description: 'Explore polymerisation, plastics, and material choices in everyday life.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'flask',
    color: '#FF9800',
    learningObjectives: [
      { id: 'cpm-1', text: 'Define polymer and monomer' },
      { id: 'cpm-2', text: 'Distinguish addition polymerisation' },
      { id: 'cpm-3', text: 'Relate material properties to uses' },
    ],
    handsOnActivity: seq('Arrange addition polymerisation steps:', [
      'Many monomers are present',
      'Double bonds open',
      'Monomers join to form long chain',
      'Polymer formed',
    ]),
    quizQuestions: makeFallbackQuestions('cpm', 'Polymers'),
  },

  // ==========================
  // PHYSICS (16)
  // ==========================
  {
    id: 'phys-energy-work-power',
    title: 'Work, Energy & Power',
    subject: 'physics',
    topic: 'Energy, Work and Power',
    description: 'Explore relationships between work done, energy transfer, and power output.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'rocket',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pew-1', text: 'Define work done and power' },
      { id: 'pew-2', text: 'Relate force, distance, and work' },
      { id: 'pew-3', text: 'Identify forms of energy and transfers' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust force, distance, and time to see how work and power change.',
      controls: [
        { id: 'F', label: 'Force', unit: 'N', min: 1, max: 200, step: 1, defaultValue: 50 },
        { id: 'd', label: 'Distance', unit: 'm', min: 1, max: 50, step: 1, defaultValue: 10 },
        { id: 't', label: 'Time', unit: 's', min: 1, max: 30, step: 1, defaultValue: 5 },
      ],
      readouts: [
        { id: 'W', label: 'Work', unit: 'J', formula: 'F*d', decimals: 0 },
        { id: 'P', label: 'Power', unit: 'W', formula: '(F*d)/t', decimals: 1 },
      ],
      tasks: [
        { id: 'pew-t1', instruction: 'Make power ≥ 200 W', condition: 'P >= 200' },
        { id: 'pew-t2', instruction: 'Make work ≤ 300 J', condition: 'W <= 300' },
        { id: 'pew-t3', instruction: 'Set time between 4 and 8 s', condition: 't >= 4 && t <= 8' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pew', 'Energy'),
  },
  {
    id: 'phys-pressure-fluids',
    title: 'Pressure in Fluids',
    subject: 'physics',
    topic: 'Pressure',
    description: 'Explore pressure in liquids and gases, and relate depth to pressure.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'water',
    color: '#2196F3',
    learningObjectives: [
      { id: 'ppf-1', text: 'Define pressure and state units' },
      { id: 'ppf-2', text: 'Explain pressure increases with depth' },
      { id: 'ppf-3', text: 'Apply pressure ideas to everyday examples' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust depth and density to observe a simple fluid pressure model (P ∝ ρ × h).',
      controls: [
        { id: 'rho', label: 'Density', unit: 'x', min: 1, max: 10, step: 1, defaultValue: 5 },
        { id: 'h', label: 'Depth', unit: 'm', min: 0, max: 20, step: 1, defaultValue: 5 },
        { id: 'g', label: 'Gravity factor', unit: 'x', min: 8, max: 12, step: 1, defaultValue: 10 },
      ],
      readouts: [
        { id: 'P', label: 'Pressure', unit: 'units', formula: 'rho*h*g', decimals: 0 },
      ],
      tasks: [
        { id: 'ppf-t1', instruction: 'Make pressure high (≥ 800)', condition: 'P >= 800' },
        { id: 'ppf-t2', instruction: 'Make pressure low (≤ 200)', condition: 'P <= 200' },
        { id: 'ppf-t3', instruction: 'Set depth to 10 m or more', condition: 'h >= 10' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('ppf', 'Pressure'),
  },
  {
    id: 'phys-momentum-collisions',
    title: 'Momentum & Collisions',
    subject: 'physics',
    topic: 'Momentum',
    description: 'Explore momentum as mass × velocity and understand conservation in collisions.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'rocket',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pmc-1', text: 'Define momentum' },
      { id: 'pmc-2', text: 'State conservation of momentum principle' },
      { id: 'pmc-3', text: 'Relate impulse to change in momentum' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Change masses and velocities to see momentum and total momentum.',
      controls: [
        { id: 'm1', label: 'Mass 1', unit: 'kg', min: 1, max: 10, step: 1, defaultValue: 2 },
        { id: 'v1', label: 'Velocity 1', unit: 'm/s', min: -10, max: 10, step: 1, defaultValue: 5 },
        { id: 'm2', label: 'Mass 2', unit: 'kg', min: 1, max: 10, step: 1, defaultValue: 2 },
      ],
      readouts: [
        { id: 'p1', label: 'Momentum 1', unit: 'kg·m/s', formula: 'm1*v1', decimals: 1 },
        { id: 'pt', label: 'Total momentum', unit: 'kg·m/s', formula: 'm1*v1 + m2*0', decimals: 1 },
      ],
      tasks: [
        { id: 'pmc-t1', instruction: 'Make p1 positive', condition: 'p1 > 0' },
        { id: 'pmc-t2', instruction: 'Make p1 negative', condition: 'p1 < 0' },
        { id: 'pmc-t3', instruction: 'Make |p1| ≥ 20', condition: 'p1 >= 20 || p1 <= -20' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pmc', 'Momentum'),
  },
  {
    id: 'phys-light-reflection',
    title: 'Reflection Ray Lab',
    subject: 'physics',
    topic: 'Light',
    description: 'Explore reflection and basic ray diagrams for plane mirrors.',
    difficulty: 'easy',
    xpReward: 150,
    estimatedTime: '10-15 mins',
    icon: 'flash',
    color: '#2196F3',
    learningObjectives: [
      { id: 'plr-1', text: 'State the law of reflection' },
      { id: 'plr-2', text: 'Draw incident, reflected rays, and normal' },
      { id: 'plr-3', text: 'Describe image properties in a plane mirror' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Change the angle of incidence and observe the reflected angle (law of reflection).',
      controls: [
        { id: 'i', label: 'Angle of incidence', unit: '°', min: 0, max: 80, step: 5, defaultValue: 30 },
        { id: 'n', label: 'Normal reference', unit: 'x', min: 1, max: 1, step: 1, defaultValue: 1 },
        { id: 'k', label: 'Mirror quality', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 3 },
      ],
      readouts: [
        { id: 'r', label: 'Angle of reflection', unit: '°', formula: 'i', decimals: 0 },
      ],
      tasks: [
        { id: 'plr-t1', instruction: 'Set incidence ≥ 50°', condition: 'i >= 50' },
        { id: 'plr-t2', instruction: 'Set incidence ≤ 20°', condition: 'i <= 20' },
        { id: 'plr-t3', instruction: 'Confirm r equals i (always true here)', condition: 'r == i' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('plr', 'Light'),
  },
  {
    id: 'phys-light-refraction',
    title: 'Refraction Explorer',
    subject: 'physics',
    topic: 'Light',
    description: 'Explore refraction at boundaries and relate speed changes to bending of light.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'flash',
    color: '#2196F3',
    learningObjectives: [
      { id: 'plf-1', text: 'Define refraction' },
      { id: 'plf-2', text: 'Predict bending towards/away from normal' },
      { id: 'plf-3', text: 'Explain refraction using speed change' },
    ],
    handsOnActivity: match('Match the situation to what happens to the ray:', [
      { left: 'Air → water', right: 'Bends towards the normal' },
      { left: 'Water → air', right: 'Bends away from the normal' },
      { left: 'Higher refractive index', right: 'Light slows down' },
      { left: 'Refraction', right: 'Bending due to speed change' },
    ]),
    quizQuestions: makeFallbackQuestions('plf', 'Light'),
  },
  {
    id: 'phys-lenses-focus',
    title: 'Lenses & Focus',
    subject: 'physics',
    topic: 'Light',
    description: 'Explore converging and diverging lenses and their uses.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'microscope',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pll-1', text: 'Distinguish converging vs diverging lenses' },
      { id: 'pll-2', text: 'Define focal point and focal length' },
      { id: 'pll-3', text: 'Relate lenses to eye/camera correction' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust focal length and object distance and observe image distance using a simple lens model.',
      controls: [
        { id: 'f', label: 'Focal length', unit: 'cm', min: 5, max: 30, step: 1, defaultValue: 10 },
        { id: 'u', label: 'Object distance', unit: 'cm', min: 6, max: 100, step: 1, defaultValue: 30 },
        { id: 'k', label: 'Lens type factor', unit: 'x', min: 1, max: 1, step: 1, defaultValue: 1 },
      ],
      readouts: [
        { id: 'v', label: 'Image distance', unit: 'cm', formula: '1/(1/f - 1/u)', decimals: 2 },
      ],
      tasks: [
        { id: 'pll-t1', instruction: 'Make image distance large (v ≥ 40 cm)', condition: 'v >= 40' },
        { id: 'pll-t2', instruction: 'Make image distance small (v ≤ 20 cm)', condition: 'v <= 20' },
        { id: 'pll-t3', instruction: 'Set object distance to 50 cm or more', condition: 'u >= 50' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pll', 'Lenses'),
  },
  {
    id: 'phys-magnetism-fields',
    title: 'Magnetic Fields Lab',
    subject: 'physics',
    topic: 'Magnetism',
    description: 'Explore magnetic field lines and simple interactions between magnets.',
    difficulty: 'easy',
    xpReward: 150,
    estimatedTime: '10-15 mins',
    icon: 'flash',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pmf-1', text: 'Describe magnetic field lines' },
      { id: 'pmf-2', text: 'Predict attraction/repulsion' },
      { id: 'pmf-3', text: 'Relate field strength to line density' },
    ],
    handsOnActivity: match('Match the statement to the correct idea:', [
      { left: 'Like poles', right: 'Repel' },
      { left: 'Unlike poles', right: 'Attract' },
      { left: 'Field lines', right: 'Show direction from N to S outside magnet' },
      { left: 'Stronger field', right: 'Lines closer together' },
    ]),
    quizQuestions: makeFallbackQuestions('pmf', 'Magnetism'),
  },
  {
    id: 'phys-electromagnets',
    title: 'Electromagnet Builder',
    subject: 'physics',
    topic: 'Electricity and Magnetism',
    description: 'Explore how current, turns, and core material affect electromagnet strength.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'flash',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pem-1', text: 'Explain what an electromagnet is' },
      { id: 'pem-2', text: 'State factors affecting strength' },
      { id: 'pem-3', text: 'Give common uses of electromagnets' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Change turns, current, and core factor to see electromagnet strength.',
      controls: [
        { id: 'turns', label: 'Turns of coil', unit: 'x', min: 10, max: 200, step: 10, defaultValue: 50 },
        { id: 'I', label: 'Current', unit: 'A', min: 0, max: 10, step: 1, defaultValue: 3 },
        { id: 'core', label: 'Core factor', unit: 'x', min: 1, max: 5, step: 1, defaultValue: 2 },
      ],
      readouts: [
        { id: 'S', label: 'Strength', unit: 'units', formula: '(turns/10)*I*core', decimals: 0 },
      ],
      tasks: [
        { id: 'pem-t1', instruction: 'Make strength ≥ 300', condition: 'S >= 300' },
        { id: 'pem-t2', instruction: 'Make strength ≤ 120', condition: 'S <= 120' },
        { id: 'pem-t3', instruction: 'Set core factor to 4 or 5', condition: 'core >= 4' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pem', 'Electromagnets'),
  },
  {
    id: 'phys-electric-power',
    title: 'Electric Power & Energy',
    subject: 'physics',
    topic: 'Electricity',
    description: 'Explore power in electrical circuits and how energy is used by appliances.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'flash',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pep-1', text: 'Use P = VI conceptually' },
      { id: 'pep-2', text: 'Relate power, energy, and time' },
      { id: 'pep-3', text: 'Interpret appliance ratings (W, kWh)' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust voltage, current, and time to see power and energy used.',
      controls: [
        { id: 'V', label: 'Voltage', unit: 'V', min: 0, max: 240, step: 10, defaultValue: 120 },
        { id: 'I', label: 'Current', unit: 'A', min: 0, max: 10, step: 1, defaultValue: 2 },
        { id: 't', label: 'Time', unit: 'h', min: 0, max: 5, step: 0.5, defaultValue: 1 },
      ],
      readouts: [
        { id: 'P', label: 'Power', unit: 'W', formula: 'V*I', decimals: 0 },
        { id: 'E', label: 'Energy', unit: 'Wh', formula: '(V*I)*t', decimals: 0 },
      ],
      tasks: [
        { id: 'pep-t1', instruction: 'Make power ≥ 500 W', condition: 'P >= 500' },
        { id: 'pep-t2', instruction: 'Make energy ≤ 200 Wh', condition: 'E <= 200' },
        { id: 'pep-t3', instruction: 'Set time to 2 hours or more', condition: 't >= 2' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pep', 'Electricity'),
  },
  {
    id: 'phys-heat-transfer',
    title: 'Heat Transfer Lab',
    subject: 'physics',
    topic: 'Thermal Physics',
    description: 'Compare conduction, convection, and radiation with everyday examples.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'flash',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pht-1', text: 'Distinguish conduction, convection, radiation' },
      { id: 'pht-2', text: 'Relate particle model to heat transfer' },
      { id: 'pht-3', text: 'Identify methods in household situations' },
    ],
    handsOnActivity: match('Match the heat transfer method to the example:', [
      { left: 'Conduction', right: 'Heat through a metal spoon' },
      { left: 'Convection', right: 'Hot water rising in a pot' },
      { left: 'Radiation', right: 'Heat from the Sun' },
      { left: 'Insulation', right: 'Reduces heat transfer' },
    ]),
    quizQuestions: makeFallbackQuestions('pht', 'Heat Transfer'),
  },
  {
    id: 'phys-sound-waves',
    title: 'Sound Waves Lab',
    subject: 'physics',
    topic: 'Waves',
    description: 'Explore how sound travels as a longitudinal wave and how pitch and loudness relate to frequency and amplitude.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'pulse',
    color: '#2196F3',
    learningObjectives: [
      { id: 'psw-1', text: 'Define longitudinal wave in terms of compressions/rarefactions' },
      { id: 'psw-2', text: 'Relate pitch to frequency' },
      { id: 'psw-3', text: 'Relate loudness to amplitude' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust frequency and wave speed to see wavelength (λ = v/f).',
      controls: [
        { id: 'v', label: 'Wave speed', unit: 'm/s', min: 100, max: 400, step: 10, defaultValue: 340 },
        { id: 'f', label: 'Frequency', unit: 'Hz', min: 50, max: 400, step: 10, defaultValue: 200 },
        { id: 'A', label: 'Amplitude', unit: 'x', min: 1, max: 10, step: 1, defaultValue: 5 },
      ],
      readouts: [
        { id: 'lam', label: 'Wavelength', unit: 'm', formula: 'v/f', decimals: 2 },
      ],
      tasks: [
        { id: 'psw-t1', instruction: 'Make wavelength ≥ 2.0 m', condition: 'lam >= 2' },
        { id: 'psw-t2', instruction: 'Make wavelength ≤ 1.0 m', condition: 'lam <= 1' },
        { id: 'psw-t3', instruction: 'Set frequency to 300 Hz or more', condition: 'f >= 300' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('psw', 'Sound'),
  },
  {
    id: 'phys-simple-harmonic-motion',
    title: 'SHM Basics',
    subject: 'physics',
    topic: 'Oscillations',
    description: 'Explore oscillations, period, and factors affecting simple pendulum motion (conceptual).',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'pulse',
    color: '#2196F3',
    learningObjectives: [
      { id: 'psh-1', text: 'Define period and frequency' },
      { id: 'psh-2', text: 'Explain how length affects pendulum period' },
      { id: 'psh-3', text: 'Relate oscillations to wave motion' },
    ],
    handsOnActivity: match('Match the term to the correct idea:', [
      { left: 'Period', right: 'Time for one complete oscillation' },
      { left: 'Frequency', right: 'Number of oscillations per second' },
      { left: 'Longer pendulum', right: 'Longer period (slower swings)' },
      { left: 'Amplitude', right: 'Maximum displacement from equilibrium' },
    ]),
    quizQuestions: makeFallbackQuestions('psh', 'Oscillations'),
  },
  {
    id: 'phys-density-buoyancy',
    title: 'Density & Buoyancy',
    subject: 'physics',
    topic: 'Properties of Matter',
    description: 'Explore density and floating/sinking using the particle model and Archimedes ideas (intro).',
    difficulty: 'easy',
    xpReward: 150,
    estimatedTime: '10-15 mins',
    icon: 'water',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pdb-1', text: 'Define density (mass/volume)' },
      { id: 'pdb-2', text: 'Predict float/sink using density comparison' },
      { id: 'pdb-3', text: 'Explain buoyancy in simple terms' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Adjust mass and volume to compute density and predict floating in water (ρwater ≈ 1).',
      controls: [
        { id: 'm', label: 'Mass', unit: 'kg', min: 1, max: 20, step: 1, defaultValue: 2 },
        { id: 'V', label: 'Volume', unit: 'L', min: 1, max: 20, step: 1, defaultValue: 4 },
        { id: 'rw', label: 'Water density', unit: 'x', min: 1, max: 1, step: 1, defaultValue: 1 },
      ],
      readouts: [
        { id: 'rho', label: 'Density', unit: 'kg/L', formula: 'm/V', decimals: 2 },
      ],
      tasks: [
        { id: 'pdb-t1', instruction: 'Make object float (density < 1)', condition: 'rho < 1' },
        { id: 'pdb-t2', instruction: 'Make object sink (density > 1)', condition: 'rho > 1' },
        { id: 'pdb-t3', instruction: 'Make density close to 1 (0.9–1.1)', condition: 'rho >= 0.9 && rho <= 1.1' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pdb', 'Density'),
  },
  {
    id: 'phys-radioactivity-intro',
    title: 'Radioactivity Intro',
    subject: 'physics',
    topic: 'Radioactivity',
    description: 'Explore alpha, beta, gamma radiation and basic safety/uses.',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'flash',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pri-1', text: 'Compare alpha, beta, gamma properties' },
      { id: 'pri-2', text: 'Explain shielding and penetration' },
      { id: 'pri-3', text: 'State common uses and safety precautions' },
    ],
    handsOnActivity: match('Match the radiation type to a key property:', [
      { left: 'Alpha (α)', right: 'Stopped by paper; low penetration' },
      { left: 'Beta (β)', right: 'Stopped by thin metal; medium penetration' },
      { left: 'Gamma (γ)', right: 'Needs thick lead; high penetration' },
      { left: 'Ionising', right: 'Can damage living cells' },
    ]),
    quizQuestions: makeFallbackQuestions('pri', 'Radioactivity'),
  },
  {
    id: 'phys-forces-equilibrium',
    title: 'Forces & Equilibrium',
    subject: 'physics',
    topic: 'Forces and Motion',
    description: 'Explore balanced forces, equilibrium, and simple vector addition ideas.',
    difficulty: 'medium',
    xpReward: 175,
    estimatedTime: '15-20 mins',
    icon: 'rocket',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pfe-1', text: 'Define balanced and unbalanced forces' },
      { id: 'pfe-2', text: 'Describe equilibrium conditions' },
      { id: 'pfe-3', text: 'Relate net force to acceleration' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Apply two forces and observe net force (positive/negative).',
      controls: [
        { id: 'F1', label: 'Force 1', unit: 'N', min: 0, max: 100, step: 5, defaultValue: 50 },
        { id: 'F2', label: 'Force 2', unit: 'N', min: 0, max: 100, step: 5, defaultValue: 30 },
        { id: 'm', label: 'Mass', unit: 'kg', min: 1, max: 20, step: 1, defaultValue: 10 },
      ],
      readouts: [
        { id: 'Fnet', label: 'Net force', unit: 'N', formula: 'F1 - F2', decimals: 0 },
        { id: 'a', label: 'Acceleration', unit: 'm/s²', formula: '(F1 - F2)/m', decimals: 2 },
      ],
      tasks: [
        { id: 'pfe-t1', instruction: 'Make net force zero (balanced)', condition: 'Fnet == 0' },
        { id: 'pfe-t2', instruction: 'Make net force positive', condition: 'Fnet > 0' },
        { id: 'pfe-t3', instruction: 'Make acceleration at least 2.0', condition: 'a >= 2' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pfe', 'Forces and Motion'),
  },
  {
    id: 'phys-circular-motion',
    title: 'Circular Motion Basics',
    subject: 'physics',
    topic: 'Forces and Motion',
    description: 'Explore circular motion ideas and why centripetal force is needed (conceptual).',
    difficulty: 'hard',
    xpReward: 225,
    estimatedTime: '20-25 mins',
    icon: 'rocket',
    color: '#2196F3',
    learningObjectives: [
      { id: 'pcm-1', text: 'Describe uniform circular motion' },
      { id: 'pcm-2', text: 'Explain centripetal force direction' },
      { id: 'pcm-3', text: 'Relate circular motion to everyday examples' },
    ],
    handsOnActivity: exp({
      type: 'experiment_runner',
      intro: 'Change speed and radius to see centripetal acceleration (a = v²/r).',
      controls: [
        { id: 'v', label: 'Speed', unit: 'm/s', min: 1, max: 20, step: 1, defaultValue: 10 },
        { id: 'r', label: 'Radius', unit: 'm', min: 1, max: 20, step: 1, defaultValue: 5 },
        { id: 'k', label: 'Factor', unit: 'x', min: 1, max: 1, step: 1, defaultValue: 1 },
      ],
      readouts: [
        { id: 'a', label: 'Centripetal accel.', unit: 'm/s²', formula: '(v*v)/r', decimals: 2 },
      ],
      tasks: [
        { id: 'pcm-t1', instruction: 'Make acceleration ≥ 20', condition: 'a >= 20' },
        { id: 'pcm-t2', instruction: 'Make acceleration ≤ 8', condition: 'a <= 8' },
        { id: 'pcm-t3', instruction: 'Set radius to 10 m or more', condition: 'r >= 10' },
      ],
      requiredTasksToUnlock: 2,
    }),
    quizQuestions: makeFallbackQuestions('pcm', 'Circular Motion'),
  },
];

