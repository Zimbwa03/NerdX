<!-- Payment Proof Details Template (loaded via AJAX) -->
<div class="row">
    <div class="col-md-6">
        <h6 class="text-primary">Payment Information</h6>
        <table class="table table-sm">
            <tr>
                <td><strong>Reference Code:</strong></td>
                <td>{{ payment.reference_code }}</td>
            </tr>
            <tr>
                <td><strong>User ID:</strong></td>
                <td><code>{{ payment.user_id }}</code></td>
            </tr>
            <tr>
                <td><strong>Package:</strong></td>
                <td>
                    {% if package %}
                        {{ package.icon }} {{ package.name }}
                    {% else %}
                        ðŸ“¦ {{ payment.package_id|title }}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td><strong>Amount:</strong></td>
                <td class="text-success"><strong>${{ "%.2f"|format(payment.amount) }}</strong></td>
            </tr>
            <tr>
                <td><strong>Credits:</strong></td>
                <td><span class="badge bg-info">{{ payment.credits }} credits</span></td>
            </tr>
            <tr>
                <td><strong>Status:</strong></td>
                <td>
                    {% if payment.status == 'pending' %}
                        <span class="badge bg-warning">Pending</span>
                    {% elif payment.status == 'approved' %}
                        <span class="badge bg-success">Approved</span>
                    {% elif payment.status == 'rejected' %}
                        <span class="badge bg-danger">Rejected</span>
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
    
    <div class="col-md-6">
        <h6 class="text-primary">Timeline</h6>
        <table class="table table-sm">
            <tr>
                <td><strong>Created:</strong></td>
                <td>{{ payment.created_at[:16] if payment.created_at else 'N/A' }}</td>
            </tr>
            <tr>
                <td><strong>Proof Submitted:</strong></td>
                <td>{{ payment.proof_submitted_at[:16] if payment.proof_submitted_at else 'N/A' }}</td>
            </tr>
            {% if payment.approved_at %}
            <tr>
                <td><strong>Approved:</strong></td>
                <td class="text-success">{{ payment.approved_at[:16] }}</td>
            </tr>
            {% endif %}
            {% if payment.rejected_at %}
            <tr>
                <td><strong>Rejected:</strong></td>
                <td class="text-danger">{{ payment.rejected_at[:16] }}</td>
            </tr>
            {% endif %}
        </table>
    </div>
</div>

{% if payment.payment_proof %}
<div class="row mt-3">
    <div class="col-12">
        <h6 class="text-primary">Payment Proof (EcoCash SMS)</h6>
        <div class="payment-proof" style="background: #e9ecef; border-radius: 8px; padding: 15px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto;">{{ payment.payment_proof }}</div>
    </div>
</div>
{% endif %}

{% if payment.rejection_reason %}
<div class="row mt-3">
    <div class="col-12">
        <h6 class="text-danger">Rejection Reason</h6>
        <div class="alert alert-danger">
            {{ payment.rejection_reason }}
        </div>
    </div>
</div>
{% endif %}

{% if payment.admin_notes %}
<div class="row mt-3">
    <div class="col-12">
        <h6 class="text-info">Admin Notes</h6>
        <div class="alert alert-info">
            {{ payment.admin_notes }}
        </div>
    </div>
</div>
{% endif %}

<!-- Business Analysis -->
{% if payment.status == 'approved' or payment.status == 'pending' %}
<div class="row mt-3">
    <div class="col-12">
        <h6 class="text-success">Profitability Analysis</h6>
        <div class="card border-success">
            <div class="card-body">
                {% set operational_cost = payment.credits * 0.009 %}
                {% set profit = payment.amount - operational_cost %}
                {% set margin = (profit / payment.amount * 100) if payment.amount > 0 else 0 %}
                
                <div class="row">
                    <div class="col-3">
                        <small class="text-muted">Revenue</small>
                        <div class="text-success"><strong>${{ "%.2f"|format(payment.amount) }}</strong></div>
                    </div>
                    <div class="col-3">
                        <small class="text-muted">Operational Cost</small>
                        <div class="text-warning"><strong>${{ "%.3f"|format(operational_cost) }}</strong></div>
                    </div>
                    <div class="col-3">
                        <small class="text-muted">Net Profit</small>
                        <div class="{{ 'text-success' if profit >= 0 else 'text-danger' }}"><strong>${{ "%.3f"|format(profit) }}</strong></div>
                    </div>
                    <div class="col-3">
                        <small class="text-muted">Profit Margin</small>
                        <div class="{{ 'text-success' if margin >= 0 else 'text-danger' }}"><strong>{{ "%.1f"|format(margin) }}%</strong></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}